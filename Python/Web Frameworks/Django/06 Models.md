Models represent our database layout, with additional metadata

## Defining Models

We add our models to the `models.py` file 
```python
from django.db import models

class Question(models.Model):
    question_text = models.CharField(max_length=200)
    pub_date = models.DateTimeField("date published")
    
class Choice(models.Model):
    question = models.ForeignKey(Question, on_delete=models.CASCADE)
    choice_text = models.CharField(max_length=200)
    votes = models.IntegerField(default=0)
```
Here, each model is represented by a class that subclasses `django.db.models.Model`

## Model Fields

Each model has a number of class variables, each of which represents a database field in the model

Each field is represented by an instance of a `Field` class (ie a type), in this case:
- `CharField` for character fields
- `DateTimeField` for datetimes
- `ForiegnKey` for one to many relationships

The name of each `Field` instance (`question_text` or `pub_date`)  can be referenced in Python code as well as a DB column name

To see commonly used `Field`s see [[#Field Class Reference]]

### Model Ids
Every model has a primary key field which is automatically generated 
This primary key field is an `id` field by default
For example, in the `Question` model, an instance `question`'s id could be referenced through `question.id` 

## Activating / Modifying Models

Django can use our model information to:
- Create a database schema (`CREATE TABLE` statements) for this app
- Create a Python database-access API for accessing our model objects

To include the app and it's models into our project, we need to add a reference to it in [[02 Setup and Settings.py#`Settings.py`|Settings.py]]
- The path to this config should be in the `apps.py` file and is automatically generated by [[01 CLI#Creating an App|Creating an app]] through the CLI

	In this example, it's `"polls.apps.PollsConfig"`

We can then use the CLI to [[01 CLI#Migrating a database| Migrate a database]] and apply our changes

**Summary:**
- Change your models (in `models.py`).
- Run [`python manage.py makemigrations`](https://docs.djangoproject.com/en/4.2/ref/django-admin/#django-admin-makemigrations) to create migrations for those changes
- Run [`python manage.py migrate`](https://docs.djangoproject.com/en/4.2/ref/django-admin/#django-admin-migrate) to apply those changes to the database.

## Model `@property` decorators

In Python, the `@property` decorator allows you to call custom model methods as if they were normal model attributes

Used is for model methods that return computed attributes

For example, we here we have the `greeting` method
```python
class Person:
    def __init__(self, first_name):
        self.first_name = first_name

    def greeting(self):
        return f'Hello {self.first_name}!'
```
To call `greeting` on a model instance, we would need to do so like so:
	`person.greeting()`

Adding the `@property` decorator to that method would allow you to access its computed value like a model attribute without parenthesis

```python
@property
def greeting(self):
	return f'Hello {self.first_name}!'
```
We can now call `greeting` like so
	`person.greeting`


## Model Manager and Methods 

Django models have an automatically-created `Manager` object inserted into the model class. This `Manager` helps in performing database queries related to the model. By default, Django adds a `Manager` with the name `objects` to every Django model class.

```python
# Accessing the manager to perform a query
all_questions = Question.objects.all()
```

`choice_set` is a related name for accessing related objects in a reverse direction. If you have a `ForeignKey` in your model, Django enables backward relations via an automatically created attribute. This attribute is named `<model>_set` by default, where `<model>` is your model name in lowercase.

```python 
# For a Question instance "q", you can access related Choice instances like this: 
choices_for_q = q.choice_set.all()
```

For every model, Django creates a set of query methods (like `.all()`, `.filter()`, `.get()`, etc.) that can be used with both the `Manager` (`objects`) and the related objects' set (`<model>_set`).

Remember, you can rename the `<model>_set` attribute by providing the `related_name` option in your `ForeignKey` definition:

```python
class Choice(models.Model):     
	question = models.ForeignKey(Question, on_delete=models.CASCADE, related_name='choices')`
```

Now you can say:

```python
choices_for_q = q.choices.all()
```

#### Field Class Reference
- `CharField`: Used for short-to-mid length strings
	- Required argument:  `max_length` : specifies the maximum length of the character field
- `TextField`: Used for large amounts of text
- `IntegerField`: Used for integers
	- Used to store `id`
- `BooleanField`: Used for boolean (True/False) values
- `DateField` and `DateTimeField`: These are used for dates and date/time respectively
- `ForeignKey`: Used for a one-to-many relationship
	- Required argument: The model which it relates to
	- For every `ForeignKey` field in a model, Django automatically provides a reverse link from the object referenced by the `ForeignKey` back to the model containing the `ForeignKey`
- `ManyToManyField`: Used for many-to-many relationships
	- Required argument: The model which it relates to
- `FileField` and `ImageField`: Used for uploaded files and images respectively
	- `upload_to` argument is usually provided to specify the upload destination


## Crud Operations

Crud operations can be performed inside [[07 Views#Interacting with Models|views]]

#### **Create**:

To create a new instance of a model, you instantiate the model and then call the `.save()` method.

```python
from myapp.models import MyModel

new_instance = MyModel(field1='value1', field2='value2')
new_instance.save()  # This will save the instance to the database
```

#### **Retrieve**:

You can retrieve instances from the database using methods on the model's manager (by default, the manager is named `objects`).

```python
# Get all instances of MyModel
all_instances = MyModel.objects.all()

# Get a single instance by its primary key
single_instance = MyModel.objects.get(pk=1)

# Get instances that meet certain criteria
filtered_instances = MyModel.objects.filter(field1='value1')
```

#### **Update**:

To update an instance, you change its attributes and then call the `.save()` method.

```python
instance = MyModel.objects.get(pk=1)
instance.field1 = 'new value'
instance.save()  # This will update the instance in the database
```

#### **Delete**:

To delete an instance, you call its `.delete()` method.

```python
instance = MyModel.objects.get(pk=1)
instance.delete()  # This will delete the instance from the database
```